<html>
<head>
	<title>SyncTab: Login</title>
	<link rel="stylesheet" type="text/css" href="styles.css"/>
	<link href='http://fonts.googleapis.com/css?family=Alike' rel='stylesheet' type='text/css'>

	<script type="text/javascript" src="jquery.min.js"></script>
	<script type="text/javascript">
		$(document).ready(function() {
			var bgPage = chrome.extension.getBackgroundPage();

			if (!bgPage.needLogin()) {
				$('#loginContent').hide();
				$("#loggedInNowContent").hide();
				$('#loggedInAlreadyContent').show();
				$('#username').text(bgPage.getUsername());
			}

			$("#email").change(function() {
				validateEmail($(this).val().trim());
			});
			$("#password").change(function() {
				validatePassword($(this).val().trim());
			});
			
			$('#loginForm').submit(function(e) {
				e.preventDefault();

				var email = $("#email").val().trim();
				var password = $("#password").val().trim();
				var hasError = false;

				hasError |= validateEmail(email);
				hasError |= validatePassword(password);

				if (!hasError) {
					bgPage.authorize(email, password, function(status) {
						if (status) {
							$("#loginContent").hide();
							$("#loggedInNowContent").show();
						}
						else {
							$('#loginError').text("Incorrect Email or Password").show();
						}
					});
				}

				return false;
			});

			$('#logout').click(function() {
				bgPage.logout(false);

				$('#loginContent').show();
				$("#loggedInNowContent").hide();
				$('#loggedInAlreadyContent').hide();
			});
		});

		function validateEmail(email) {
			if (!email) {
				$('#emailError').text("Email is required").show();
				return true;
			}
			
			$('#emailError').hide();
			return false;
		}

		function validatePassword(password) {
			if (!password) {
				$('#passwordError').text("Password is required").show();
				return true;
			}
			
			$('#passwordError').hide();
			return false;
		}
	</script>
</head>
<body>
	<div id="content">
		<div id="loginContent">
			<form id="loginForm" action="">
				<h1><span>SyncTab:</span> Login</h1>

				<p id="loginError" class="formError"></p>
				
				<p>
					<label for="email">Your Email</label>
					<input type="text" id="email" value="" maxlength="400" autofocus="true"/>
					<span id="emailError" class="error"></span>
				</p>

				<p>
					<label for="password">Your Password</label>
					<input type="password" id="password" value="" maxlength="100"/>
					<span id="passwordError" class="error"></span>
				</p>

				<p><input type="submit" id="login" class="mainButton" value="Login"/></p>
				<div class="clear"></div>

				<p style="text-align: right;">Not registered yet? - <a href="register.html">Register Now</a></p>
			</form>
		</div>
		<div id="loggedInNowContent" class="notice" style="display: none">
			<h2><span>SyncTab:</span> Notice</h2>
			<p>
				You are logged in now.<br/><br/>
				<a href="javascript:void(0);" onclick="window.close()">Continue Your Work</a>
			</p>
		</div>
		<div id="loggedInAlreadyContent" class="notice" style="display: none">
			<h2><span>SyncTab:</span> Notice</h2>
			<p>
				You are logged in as <span id="username" class="custom"></span> already.<br/><br/>
				<a href="javascript:void(0);" id="logout">Logout</a> &nbsp;|&nbsp;
				<a href="javascript:void(0);" onclick="window.close()">Close This Window</a>
			</p>
		</div>

		
		<div id="footer">
			<div id="left">Copyright (c) 2011 <a href="http://www.khmelyuk.com">Ruslan Khmelyuk</a></div>
			<div id="right"><a href="http://synctab.khmelyuk.com">synctab.khmelyuk.com</a></div>
			<div class="clear"></div>
		</div>
	</div>
</body>
</html>