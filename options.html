<html>
<head>
	<title>SyncTab: Options</title>
	<link rel="stylesheet" type="text/css" href="styles.css"/>

	<script type="text/javascript" src="jquery.min.js"></script>
	<script type="text/javascript" src="synctab.js"></script>
	<script type="text/javascript">
		$(document).ready(function() {
			var bgPage = chrome.extension.getBackgroundPage();

			var options = SyncTab.options;

			function showTagsAsOptions() {
				$('#tag').empty();

				var tags = options.tags.getArray();
				var tagsLen = tags.length;
				for (var i = 0; i < tagsLen; i++) {
					var tag = tags[i];
					var option = "<option value='"+tag.id + "'>" + tag.name + "</option>";
					$('#tag').append(option);
				}

				$('#tag').val(options.tag.get());
			}

			if (SyncTab.needLogin()) {
				$('#accountInfo').hide();
				$('#guest').show();
			}
			else {
				var tags = options.tags.getArray();
				if (tags.length > 0) {
					console.log(tags);
					showTagsAsOptions();
				}
				else {
					SyncTab.loadTags(function(status) {
						if (status) showTagsAsOptions();
					});
				}
			}

			$('#email').text(options.email.get());
			$("#addToBookmarks").val(options.addToBookmarks.get());
			$("#refreshInterval").val(options.refreshInterval.get());
			$("#selectOpenedTab").val(options.selectOpenedTab.get());
			$("#showNotifications").val(options.showNotifications.get());

			$('#logout').click(function() {
				bgPage.logout(false);

				$('#accountInfo').hide();
				$('#guest').show();
			});

			$('.optionValue').change(function(e) {

				var tag = $('#tag').val();
				var refreshInterval = $("#refreshInterval").val();
				var addToBookmarks = $("#addToBookmarks").val().trim();
				var selectOpenedTab = $("#selectOpenedTab").val().trim();
				var showNotifications = $("#showNotifications").val().trim();

				options.tag.set(tag);
				options.addToBookmarks.set(addToBookmarks);
				options.refreshInterval.set(refreshInterval);
				options.selectOpenedTab.set(selectOpenedTab);
				options.showNotifications.set(showNotifications);

				bgPage.optionsChanged();
			});
		});
	</script>
</head>
<body>
	<div id="content" class="options">
		<div id="formContent">
			
			<h1><span>SyncTab:</span> Options</h1>

			<p id="guest" style="display: none; float: right;">
				<a href="login.html">Login</a> -
				<a href="register.html">Register Now</a>
			</p>
			<div class="clear"></div>

			<div id="accountInfo" class="option">
				<div class="info">
					<div class="title">Account</div>
					<div class="description">What account you're currently using</div>
				</div>
				<div class="value">
					<strong><span id="email"></span></strong>&nbsp;&nbsp;
					<button id="logout" class="logoutButton">Logout</button>
				</div>
				<div class="clear"></div>
			</div>

			<div class="option">
				<div class="info">
					<div class="title">Browser Tag</div>
					<div class="description">You can send links to only this browser using specified tag.</div>
				</div>
				<div class="value">
					<select id="tag" class="optionValue">
					</select>
				</div>
				<div class="clear"></div>
			</div>

			<div class="option">
				<div class="info">
					<div class="title">Refresh Period</div>
					<div class="description">How often to check for and pull new tabs?</div>
				</div>
				<div class="value">
					<select id="refreshInterval" class="optionValue">
						<option value="60000">1 minute</option>
						<option value="180000">3 minutes</option>
						<option value="300000">5 minutes</option>
						<option value="600000">10 minutes</option>
					</select>
				</div>
				<div class="clear"></div>
			</div>

			<div class="option">
				<div class="info">
					<div class="title">Show Notifications</div>
					<div class="description">Do you want to see notifications about just opened tabs?</div>
				</div>
				<div class="value">
					<select id="showNotifications" class="optionValue">
						<option value="true">Yes</option>
						<option value="false">No</option>
					</select>
				</div>
				<div class="clear"></div>
			</div>

			<div class="option">
				<div class="info">
					<div class="title">Select Tab on Open</div>
					<div class="description">Do you want to select a new tab when it's open in a browser?</div>
				</div>
				<div class="value">
					<select id="selectOpenedTab" class="optionValue">
						<option value="true">Yes</option>
						<option value="false">No</option>
					</select>
				</div>
				<div class="clear"></div>
			</div>

			<div class="option">
				<div class="info">
					<div class="title">Add Tabs to Bookmarks</div>
					<div class="description">We may add a shared tabs to the browser bookmarks, so later you can back to them (of course, if you don't forget about bookmarks). Do you want that?</div>
				</div>
				<div class="value">
					<select id="addToBookmarks" class="optionValue">
						<option value="true">Yes</option>
						<option value="false">No</option>
					</select>
				</div>
				<div class="clear"></div>
			</div>

			<br/>
		</div>

		
		<div id="footer">
			<div id="left">Copyright &copy; 2011 <a href="http://www.khmelyuk.com">Ruslan Khmelyuk</a></div>
			<div id="right">
				<a href="http://synctab.khmelyuk.com/download"><strong>Download Android Application</strong></a> |
				<a href="http://synctab.khmelyuk.com">synctab.khmelyuk.com</a>
			</div>
			<div class="clear"></div>
		</div>
	</div>
</body>
</html>